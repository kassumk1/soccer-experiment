<!DOCTYPE html>
<html>
<head>
    <title>Auditory-Visual Localization Experiment</title>
    
    <script src="https://unpkg.com/jspsych@7.3.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-button-response@1.1.2"></script>
    
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4; 
        }
        .jspsych-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 50px auto;
        }
        .jspsych-btn {
            font-size: 16px !important; 
            padding: 10px 18px !important;
            margin: 0 5px !important; 
            background-color: #007bff; 
            color: white;
            border: none;
            cursor: pointer;
        }
        #stimulus-area {
            border: 2px solid #333; 
            background-color: #000;
            color: #fff;
            height: 450px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="jspsych-display"></div>
    
    <script>
        // Initialize JsPsych
        var jsPsych = initJsPsych({
            display_element: 'jspsych-display',
            
            // ðŸš¨ FIX: This is the updated function to display a clean finish message 
            on_finish: function() {
                // Clear the main display area
                document.getElementById('jspsych-display').innerHTML = 
                    '<div class="jspsych-content" style="text-align: center;">' +
                    '<h1>âœ… Experiment Complete</h1>' +
                    '<h2>Thank you for participating in the localization study!</h2>' +
                    '<p>The structural demo has concluded. You may now close this window.</p>' +
                    '</div>';
                
                // Optional: For debugging, you can still log the data to the console
                // console.log(jsPsych.data.get().json());
            }
        });

        // --- 1. Welcome and Instructions Trial ---
        var welcome = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: '<h1>Auditory-Visual Localization Experiment</h1>' + 
                      '<p>Thank you for participating. This is a practice trial to familiarize you with the procedure.</p>' +
                      '<p>Press the **SPACEBAR** to begin.</p>',
            choices: [' '], 
            post_trial_gap: 500 
        };

        // --- 2. The Animation/Stimulus Phase (ROBUST HTML PLACEHOLDER) ---
        var animation_phase = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: '<div id="stimulus-area">' +
                      '<h2>âš½ STIMULUS DISPLAY AREA âš½</h2>' +
                      '<p>Imagine the video of the player kicking the ball is playing here.</p>' +
                      '<p>The visual and auditory information has been delivered.</p>' +
                      '</div>' +
                      '<p>Press **ENTER** to immediately advance to the response screen (The "Cut-Off" Point).</p>',
            
            choices: ['Enter'], 
            trial_duration: 3000, 
            response_ends_trial: true, 
            data: { task: 'stimulus_placeholder' }
        };

        // --- 3. The Response Phase (5-Option Array) ---
        var response_phase = {
            type: jsPsychImageButtonResponse,
            stimulus: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Soccer_field_-_empty.png/640px-Soccer_field_-_empty.png', 
            stimulus_height: 350, 
            prompt: '<h3 style="margin-top: 20px;">Indicate the estimated landing position of the ball.</h3>',
            choices: ['Very Close (5m)', 'Close (10m)', 'Medium (15m)', 'Far (20m)', 'Very Far (25m)'],
            button_html: '<button class="jspsych-btn">%choice%</button>', 
            data: { task: 'response_array' }
        };

        // --- 4. Trial Timeline ---
        var timeline = [];
        timeline.push(welcome);
        timeline.push(animation_phase);
        timeline.push(response_phase);

        // --- 5. Run Experiment ---
        jsPsych.run(timeline);
    </script>
</body>
</html>